

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lookup Tables &mdash; pyRTX 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=2389946f"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../api/index.html" />
    <link rel="prev" title="Solar Radiation Pressure: Various contributions" href="Notebook2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pyRTX
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#from-source">From Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#build-dependencies">Build Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#runtime-dependencies">Runtime Dependencies</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#tutorial-1-first-steps-with-pyrtx">Tutorial 1: First Steps with pyRTX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Notebook1.html">Notebook n. 1:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Notebook1.html#Spacecraft-shape-definition">Spacecraft shape definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="Notebook1.html#Speeding-up-the-code">Speeding up the code</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tutorial-2-advanced-srp-calculations">Tutorial 2: Advanced SRP Calculations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Notebook2.html">Solar Radiation Pressure: Various contributions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Notebook2.html#Effect-of-diffusion">Effect of diffusion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#tutorial-3-lookup-tables">Tutorial 3: Lookup Tables</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Lookup Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Computing-the-LUT">Computing the LUT</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/core.html">Core Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/core.html#module-pyRTX.core.utils_rt">Ray Tracing Utilities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.chunker"><code class="docutils literal notranslate"><span class="pre">chunker()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.pxform_convert"><code class="docutils literal notranslate"><span class="pre">pxform_convert()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.block_normalize"><code class="docutils literal notranslate"><span class="pre">block_normalize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.block_dot"><code class="docutils literal notranslate"><span class="pre">block_dot()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.pixel_plane"><code class="docutils literal notranslate"><span class="pre">pixel_plane()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.fast_vector_build"><code class="docutils literal notranslate"><span class="pre">fast_vector_build()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.pixel_plane_opt"><code class="docutils literal notranslate"><span class="pre">pixel_plane_opt()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.reflected"><code class="docutils literal notranslate"><span class="pre">reflected()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.get_orthogonal"><code class="docutils literal notranslate"><span class="pre">get_orthogonal()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.sample_lambert_dist"><code class="docutils literal notranslate"><span class="pre">sample_lambert_dist()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.diffuse"><code class="docutils literal notranslate"><span class="pre">diffuse()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.compute_secondary_bounce"><code class="docutils literal notranslate"><span class="pre">compute_secondary_bounce()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.save_for_visualization"><code class="docutils literal notranslate"><span class="pre">save_for_visualization()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.exportEXAC"><code class="docutils literal notranslate"><span class="pre">exportEXAC()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.Embree3_init_geometry"><code class="docutils literal notranslate"><span class="pre">Embree3_init_geometry()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.Embree3_init_rayhit"><code class="docutils literal notranslate"><span class="pre">Embree3_init_rayhit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.Embree3_dump_solution"><code class="docutils literal notranslate"><span class="pre">Embree3_dump_solution()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.cgal_init_geometry"><code class="docutils literal notranslate"><span class="pre">cgal_init_geometry()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.get_centroids"><code class="docutils literal notranslate"><span class="pre">get_centroids()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.get_cross_products"><code class="docutils literal notranslate"><span class="pre">get_cross_products()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.get_face_areas"><code class="docutils literal notranslate"><span class="pre">get_face_areas()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.get_surface_normals"><code class="docutils literal notranslate"><span class="pre">get_surface_normals()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.get_surface_normals_and_face_areas"><code class="docutils literal notranslate"><span class="pre">get_surface_normals_and_face_areas()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.ShapeModel"><code class="docutils literal notranslate"><span class="pre">ShapeModel</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.TrimeshShapeModel"><code class="docutils literal notranslate"><span class="pre">TrimeshShapeModel</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.CgalTrimeshShapeModel"><code class="docutils literal notranslate"><span class="pre">CgalTrimeshShapeModel</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.EmbreeTrimeshShapeModel"><code class="docutils literal notranslate"><span class="pre">EmbreeTrimeshShapeModel</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.utils_rt.RTXkernel"><code class="docutils literal notranslate"><span class="pre">RTXkernel()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/core.html#shadow-utilities">Shadow Utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/core.html#module-pyRTX.core.physical_utils">Physical Utilities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.physical_utils.preprocess_RTX_geometry"><code class="docutils literal notranslate"><span class="pre">preprocess_RTX_geometry()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.physical_utils.preprocess_materials"><code class="docutils literal notranslate"><span class="pre">preprocess_materials()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.physical_utils.srp_core"><code class="docutils literal notranslate"><span class="pre">srp_core()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.physical_utils.compute_srp"><code class="docutils literal notranslate"><span class="pre">compute_srp()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/core.html#module-pyRTX.core.parallel_utils">Parallel Utilities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.parallel_utils.get_ncores"><code class="docutils literal notranslate"><span class="pre">get_ncores()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.parallel_utils.is_method"><code class="docutils literal notranslate"><span class="pre">is_method()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.parallel_utils.get_unwrapped"><code class="docutils literal notranslate"><span class="pre">get_unwrapped()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/core.html#pyRTX.core.parallel_utils.parallel"><code class="docutils literal notranslate"><span class="pre">parallel()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/classes.html">Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/classes.html#sunshadow">SunShadow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/classes.html#solarpressure">SolarPressure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/classes.html#planet">Planet</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/classes.html#pyRTX.classes.Planet.Planet"><code class="docutils literal notranslate"><span class="pre">Planet</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/classes.html#pixelplane">PixelPlane</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/classes.html#pyRTX.classes.PixelPlane.PixelPlane"><code class="docutils literal notranslate"><span class="pre">PixelPlane</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/classes.html#spacecraft">Spacecraft</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/classes.html#pyRTX.classes.Spacecraft.Spacecraft"><code class="docutils literal notranslate"><span class="pre">Spacecraft</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/defaults.html">Default Values and Constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/index.html#core-modules">Core Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pyRTX.core.html">pyRTX.core</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/pyRTX.core.analysis_utils.html">pyRTX.core.analysis_utils</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/pyRTX.core.parallel_utils.html">pyRTX.core.parallel_utils</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/pyRTX.core.physical_utils.html">pyRTX.core.physical_utils</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/pyRTX.core.shadow_utils.html">pyRTX.core.shadow_utils</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/pyRTX.core.utils_rt.html">pyRTX.core.utils_rt</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/index.html#classes">Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pyRTX.classes.html">pyRTX.classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/pyRTX.classes.Atmosphere.html">pyRTX.classes.Atmosphere</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/pyRTX.classes.Drag.html">pyRTX.classes.Drag</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/pyRTX.classes.LookUpTable.html">pyRTX.classes.LookUpTable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/pyRTX.classes.PixelPlane.html">pyRTX.classes.PixelPlane</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/pyRTX.classes.Planet.html">pyRTX.classes.Planet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/pyRTX.classes.Precompute.html">pyRTX.classes.Precompute</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/pyRTX.classes.Radiation.html">pyRTX.classes.Radiation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/pyRTX.classes.RayTracer.html">pyRTX.classes.RayTracer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/pyRTX.classes.SRP.html">pyRTX.classes.SRP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/generated/pyRTX.classes.Spacecraft.html">pyRTX.classes.Spacecraft</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyRTX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Lookup Tables</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/Notebook3.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Lookup-Tables">
<h1>Lookup Tables<a class="headerlink" href="#Lookup-Tables" title="Permalink to this heading"></a></h1>
<p>Until now we have performed what we call “live” calculations. This means that at each epoch of interest we have requested the spacecraft position, attitude, the position of the sun, the spacecraft distance from the Sun, etc.</p>
<p>For some calculations, e.g., involving tight time sampling, or when computing planetary radiation (see below) this approach might just be too computationally expensive to be acceptable. This is why we introduce the concept of the <em>Lookup Table of Normalized Geometry Vectors</em> (<strong>LUT</strong>)</p>
<p>The fundamental concept behind it is that since we can write radiative accelerations as:</p>
<center><p><span class="math notranslate nohighlight">\(\vec{a} = \frac{k}{c} \, \mathbb{L}(\alpha, \delta)\)</span></p>
</center><p>Where <span class="math notranslate nohighlight">\(k\)</span> depends on the specific acceleration we are computing and <span class="math notranslate nohighlight">\(c\)</span> is the speed of light (e.g., <span class="math notranslate nohighlight">\(\Phi/mc\)</span> for solar radiation pressure) and <span class="math notranslate nohighlight">\(\mathbb{L}\)</span> is what we define as the <em>geometry vector</em>.</p>
<p>The geometry vector depends only on the shape of the spacecraft, its thermo-optical properties and the incoming direction of a photon/ray (described through a righ ascension, <span class="math notranslate nohighlight">\(\alpha\)</span> and declination <span class="math notranslate nohighlight">\(\delta\)</span>).</p>
<p>Once the LUT is computed, we ideally can just plug it in pyRTX and compute the accelerations we need.</p>
</section>
<section id="Computing-the-LUT">
<h1>Computing the LUT<a class="headerlink" href="#Computing-the-LUT" title="Permalink to this heading"></a></h1>
<p>The computation of the LUT is conceptually simple: we want to predict all the possible attitudes that the spacecraft will undergo with respect to the radiation source and have the corresponding geometry vectors computed and written down. When actually computing the acceleration we will just interpolate the LUT to the requested attitude.</p>
<p>Note that here the “attitude” concept is quite general. Say that you have a cylindrical spacecraft orbiting a planet and its long axis is nadir-oriented. Then the <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\delta\)</span> of the Sun in the body-fixed frame will change along the orbit. Thus one can pre-compute the expected range of <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\delta\)</span> and compute the LUT on this range</p>
<p>There are, of course, more complex examples. Think, for example, of a spacecraft with moving parts. Then in that case one must create the LUT spanning not only the <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\delta\)</span> angles, but also all possible configurations of the moving appendages.</p>
<p>Let’s start with a simple example (they cylindrical spacecraft)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">trimesh</span> <span class="k">as</span> <span class="nn">tm</span>
<span class="kn">from</span> <span class="nn">pyRTX.visual.utils</span> <span class="kn">import</span> <span class="n">plot_mesh</span>
<span class="kn">from</span> <span class="nn">pyRTX.classes.SRP</span> <span class="kn">import</span> <span class="n">SolarPressure</span>
<span class="kn">from</span> <span class="nn">pyRTX.classes.Spacecraft</span> <span class="kn">import</span> <span class="n">Spacecraft</span>
<span class="kn">from</span> <span class="nn">pyRTX.classes.PixelPlane</span> <span class="kn">import</span> <span class="n">PixelPlane</span>
<span class="kn">from</span> <span class="nn">pyRTX.classes.RayTracer</span> <span class="kn">import</span> <span class="n">RayTracer</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="c1"># Create a simple spacecraft (a capsule/cylinder)</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">creation</span><span class="o">.</span><span class="n">capsule</span><span class="p">(</span><span class="n">height</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span> <span class="p">)</span>
<span class="n">plot_mesh</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Spacecraft&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Notebook3_3_0.png" src="../_images/tutorials_Notebook3_3_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We need to create the spacecraft object</span>
<span class="n">sc_model</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;BUS&#39;</span><span class="p">:{</span>
    <span class="s1">&#39;file&#39;</span> <span class="p">:</span> <span class="n">sc</span><span class="p">,</span>
    <span class="s1">&#39;frame_type&#39;</span><span class="p">:</span> <span class="s1">&#39;UD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;frame_name&#39;</span><span class="p">:</span> <span class="s1">&#39;BUS_FRAME&#39;</span><span class="p">,</span>
    <span class="s1">&#39;UD_rotation&#39;</span> <span class="p">:</span> <span class="n">tm</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">identity_matrix</span><span class="p">(),</span>
    <span class="s1">&#39;center&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="s1">&#39;specular&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="s1">&#39;diffuse&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}}</span>
<span class="n">sc_object</span> <span class="o">=</span> <span class="n">Spacecraft</span><span class="p">(</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Capsule&#39;</span><span class="p">,</span>
                <span class="n">base_frame</span> <span class="o">=</span> <span class="s1">&#39;BUS_FRAME&#39;</span><span class="p">,</span>
                <span class="n">mass</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># NOTE: here the mass is 1 because we want to compute the LUT</span>
                <span class="n">spacecraft_model</span> <span class="o">=</span> <span class="n">sc_model</span><span class="p">,</span>
                <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span>
<br/><br/></pre></div>
</div>
</div>
<p>After having defined the spacecraft, we need to define the ranges of angles that we will be analyzing. For simplicity let’s say that we expect the spacecraft to “see” the Sun in every possible configuration: i.e., alpha in <span class="math notranslate nohighlight">\([0, 2\pi]\)</span> and delta in <span class="math notranslate nohighlight">\([-\pi/2, \pi/2]\)</span></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># One of the most important design parameters is the grid resolution</span>
<span class="c1"># For now let&#39;s set the sampling at 10 degrees</span>
<span class="n">grid_res</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span> <span class="c1"># radians</span>

<span class="n">RA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">grid_res</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">DEC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">grid_res</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<br/><br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now we have to define the pixel plane and the ray tracer</span>
<span class="n">rays</span> <span class="o">=</span> <span class="n">PixelPlane</span><span class="p">(</span>
        <span class="n">spacecraft</span> <span class="o">=</span> <span class="n">sc_object</span><span class="p">,</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;Fixed&#39;</span><span class="p">,</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
        <span class="n">height</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
        <span class="n">ray_spacing</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
        <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="p">)</span>


<span class="n">rtx</span> <span class="o">=</span> <span class="n">RayTracer</span><span class="p">(</span>
        <span class="n">sc_object</span><span class="p">,</span>
        <span class="n">rays</span><span class="p">,</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="s1">&#39;Embree3&#39;</span><span class="p">,</span>
        <span class="n">bounces</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">diffusion</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># And define the solar pressure object</span>
<span class="n">srp</span> <span class="o">=</span> <span class="n">SolarPressure</span><span class="p">(</span><span class="n">sc_object</span><span class="p">,</span> <span class="n">rtx</span><span class="p">,</span> <span class="n">baseflux</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>You’ll have possibly noticed a couple of strange things:</p>
<ol class="arabic simple">
<li><p>The mass of the spacecraft is 1</p></li>
<li><p>The flux of the Sun is None</p></li>
</ol>
<p>These settings are related to our goal of computing the LUT. Indeed we want only to compute the geometry vector, so if you look at the equation at the beginning of this notebook, we know that the Solar Pressure is computed as</p>
<center><p><span class="math notranslate nohighlight">\(\frac{\Phi}{mc} \mathbb{L}\)</span></p>
</center><p>So, we need to set <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(\Phi\)</span> to unit values to get <span class="math notranslate nohighlight">\(\mathbb{L}\)</span>.</p>
<p>Now, what is left to do is to compute the LUT!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define an attribute dictionary for the LUT</span>
<span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dims</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RA</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DEC</span><span class="p">)</span>
<span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ra&#39;</span><span class="p">)</span>
<span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;dec&#39;</span><span class="p">)</span>
<span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>


<span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;base_frame&#39;</span> <span class="p">:</span> <span class="s1">&#39;BUS_FRAME&#39;</span><span class="p">,</span>
    <span class="s1">&#39;units&#39;</span> <span class="p">:</span> <span class="s1">&#39;km/s**2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ref_epoch&#39;</span> <span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span>
    <span class="s1">&#39;dims&#39;</span> <span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dims</span><span class="p">),</span>
    <span class="c1"># These are needed when there are moving parts.</span>
    <span class="c1"># It will be discussed in a later example</span>
    <span class="s1">&#39;eul_set&#39;</span> <span class="p">:</span> <span class="s1">&#39;1,2,3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;moving_frames&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="p">}</span>


<span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="n">dims</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">vals</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">)}</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> *** LUT size: </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s1"> ...&#39;</span><span class="p">)</span>
<span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 *** LUT size: (37, 19, 3) ...
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">ir</span><span class="p">,</span> <span class="n">ra</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">RA</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ide</span><span class="p">,</span> <span class="n">dec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">DEC</span><span class="p">):</span>
        <span class="n">srp</span><span class="o">.</span><span class="n">rayTracer</span><span class="o">.</span><span class="n">rays</span><span class="o">.</span><span class="n">update_latlon</span><span class="p">(</span><span class="n">lon</span> <span class="o">=</span> <span class="n">ra</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">dec</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">srp</span><span class="o">.</span><span class="n">compute</span><span class="p">([</span><span class="kc">None</span><span class="p">]))</span>
        <span class="n">lut</span><span class="p">[</span><span class="n">ir</span><span class="p">,</span> <span class="n">ide</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># And transform it in an xarray for easier manipulation</span>
<span class="n">LUT</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">data_vars</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;look_up_table&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">lut</span><span class="p">)},</span>
                 <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">,</span>
                 <span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">LUT</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.Dataset&gt;
Dimensions:        (ra: 37, dec: 19, value: 3)
Coordinates:
  * ra             (ra) float64 0.0 0.1745 0.3491 0.5236 ... 5.934 6.109 6.283
  * dec            (dec) float64 -1.571 -1.396 -1.222 ... 1.222 1.396 1.571
Dimensions without coordinates: value
Data variables:
    look_up_table  (ra, dec, value) float64 -7.433e-15 -6.592e-15 ... -1.021e-11
Attributes:
    base_frame:     BUS_FRAME
    units:          km/s**2
    ref_epoch:      None
    dims:           ra,dec,value
    eul_set:        1,2,3
    moving_frames:
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The LUT is computed! We can inspect it by plotting the acceleration over different directions</span>
<span class="c1"># First adjust the coordinates to be in degrees, for easier visualization</span>
<span class="n">LUT1</span> <span class="o">=</span> <span class="n">LUT</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span>
    <span class="n">ra</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">LUT</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">]),</span>
    <span class="n">dec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">LUT</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
<span class="p">)</span>

<span class="c1"># To see what the SRP acceleration would look like, let&#39;s multiply the geometry</span>
<span class="c1"># vector by phi/m and convert to m/s2</span>
<span class="n">phi</span> <span class="o">=</span> <span class="mi">1670</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">LUT1</span> <span class="o">=</span> <span class="n">LUT1</span> <span class="o">*</span> <span class="n">phi</span><span class="o">/</span><span class="n">m</span> <span class="o">*</span> <span class="mi">1000</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">LUT1</span><span class="p">[</span><span class="s1">&#39;look_up_table&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;dec&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,)</span>

<span class="n">norm_data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">apply_ufunc</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
    <span class="n">LUT1</span><span class="p">[</span><span class="s1">&#39;look_up_table&#39;</span><span class="p">],</span>
    <span class="n">input_core_dims</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;value&#39;</span><span class="p">]],</span>  <span class="c1"># Specify which dimension to operate on</span>
    <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;axis&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span class="p">)</span>

<span class="n">norm_data</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;dec&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;NORM&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Notebook3_14_0.png" src="../_images/tutorials_Notebook3_14_0.png" />
</div>
</div>
<p>Now that we have computed the LUT we can see how it can be useful.</p>
<p><strong>Note</strong> that in this case the calculation was simple/fast on purpose (to make this example runnable in a reasonable amount of time). Typical cases (e.g., with complex shapes and moving appendages) require much more time, and some additional coding effort (e.g., parallelization). You can find a full, in-depth, example of the computation of the LUT for Lunar Reconnaissance Orbiter in the <code class="docutils literal notranslate"><span class="pre">examples</span></code> folder (<code class="docutils literal notranslate"><span class="pre">examples/compute_lut.py</span></code>)</p>
<p>In a normal case one would save the LUT to a file for later use. The preferred format for pyRTX is NetCDF</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LUT</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s1">&#39;capsule_lut.nc&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">LUT</span><span class="o">.</span><span class="n">encoding</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;zlib&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;complevel&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}))</span>
<br/><br/><br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<p>To make the example realistic, we will assume that the spacecraft for which we have computed the LUT is Lunar Reconnaissance Orbiter. This way we can take advantage of the kernels (trajectory, etc) that we have used in the previous examples.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s see how to use the LUT now!</span>
<span class="c1"># pyRTX exposes a class specifically thought to work with LUTs</span>
<span class="kn">from</span> <span class="nn">pyRTX.classes.LookUpTable</span> <span class="kn">import</span> <span class="n">LookUpTable</span>
<span class="kn">from</span> <span class="nn">pyRTX.classes.Planet</span> <span class="kn">import</span> <span class="n">Planet</span>
<span class="kn">from</span> <span class="nn">pyRTX.classes.SRP</span> <span class="kn">import</span> <span class="n">SunShadow</span><span class="p">,</span> <span class="n">SolarPressure</span>
<span class="kn">from</span> <span class="nn">pyRTX.classes.Precompute</span> <span class="kn">import</span> <span class="n">Precompute</span>
<span class="kn">import</span> <span class="nn">spiceypy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">pyRTX.core.analysis_utils</span> <span class="kn">import</span> <span class="n">epochRange2</span>
<span class="kn">import</span> <span class="nn">timeit</span>

<span class="n">METAKR</span> <span class="o">=</span> <span class="s1">&#39;../example_data/LRO/metakernel_lro.tm&#39;</span>     <span class="c1"># metakernel</span>
<span class="n">sp</span><span class="o">.</span><span class="n">furnsh</span><span class="p">(</span><span class="n">METAKR</span><span class="p">)</span>  <span class="c1"># Load the metakernel containing references to the necessary SPICE frames</span>

<span class="n">lut</span> <span class="o">=</span> <span class="n">LookUpTable</span><span class="p">(</span><span class="s1">&#39;capsule_lut.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ref_epc</span>     <span class="o">=</span> <span class="s2">&quot;2010 may 10 09:25:00&quot;</span>
<span class="n">duration</span>    <span class="o">=</span> <span class="mi">10000</span>
<span class="n">timestep</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># Define a basic epoch</span>
<span class="n">epc_et0</span> <span class="o">=</span>  <span class="n">sp</span><span class="o">.</span><span class="n">str2et</span><span class="p">(</span> <span class="n">ref_epc</span> <span class="p">)</span>
<span class="n">epc_et1</span>  <span class="o">=</span> <span class="n">epc_et0</span> <span class="o">+</span> <span class="n">duration</span>
<span class="n">epochs</span>   <span class="o">=</span> <span class="n">epochRange2</span><span class="p">(</span><span class="n">startEpoch</span> <span class="o">=</span> <span class="n">epc_et0</span><span class="p">,</span> <span class="n">endEpoch</span> <span class="o">=</span> <span class="n">epc_et1</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="n">timestep</span><span class="p">)</span>





<span class="n">sc_model</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;BUS&#39;</span><span class="p">:{</span>
    <span class="s1">&#39;file&#39;</span> <span class="p">:</span> <span class="n">sc</span><span class="p">,</span>
    <span class="s1">&#39;frame_type&#39;</span><span class="p">:</span> <span class="s1">&#39;Spice&#39;</span><span class="p">,</span>
    <span class="s1">&#39;frame_name&#39;</span><span class="p">:</span> <span class="s1">&#39;LRO_SC_BUS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;center&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="s1">&#39;specular&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="s1">&#39;diffuse&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}}</span>

<span class="n">lro</span> <span class="o">=</span> <span class="n">Spacecraft</span><span class="p">(</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;LRO&#39;</span><span class="p">,</span>
                <span class="n">base_frame</span> <span class="o">=</span> <span class="s1">&#39;LRO_SC_BUS&#39;</span><span class="p">,</span>
                <span class="n">mass</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>
                <span class="n">spacecraft_model</span> <span class="o">=</span> <span class="n">sc_model</span><span class="p">,</span>
                <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span>


<span class="c1"># Define the Moon object</span>
<span class="n">moon</span> <span class="o">=</span> <span class="n">Planet</span><span class="p">(</span>  <span class="n">fromFile</span>      <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">radius</span>        <span class="o">=</span> <span class="mf">1737.4</span><span class="p">,</span>
                <span class="n">name</span>          <span class="o">=</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span>
                <span class="n">bodyFrame</span>     <span class="o">=</span> <span class="s1">&#39;MOON_PA&#39;</span><span class="p">,</span>
                <span class="n">sunFixedFrame</span> <span class="o">=</span> <span class="s1">&#39;GSE_MOON&#39;</span><span class="p">,</span>
                <span class="n">units</span>         <span class="o">=</span> <span class="s1">&#39;km&#39;</span><span class="p">,</span>
                <span class="n">subdivs</span>       <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                <span class="p">)</span>


<span class="n">prec</span> <span class="o">=</span> <span class="n">Precompute</span><span class="p">(</span><span class="n">epochs</span> <span class="o">=</span> <span class="n">epochs</span><span class="p">,)</span>
<span class="n">prec</span><span class="o">.</span><span class="n">precomputeSolarPressure</span><span class="p">(</span><span class="n">lro</span><span class="p">,</span> <span class="n">moon</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="s1">&#39;LT+S&#39;</span><span class="p">)</span>
<span class="n">prec</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>

<span class="c1"># Define the shadow function object</span>
<span class="n">shadow</span> <span class="o">=</span> <span class="n">SunShadow</span><span class="p">(</span> <span class="n">spacecraft</span>     <span class="o">=</span> <span class="n">lro</span><span class="p">,</span>
                                <span class="n">body</span>           <span class="o">=</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span>
                                <span class="n">bodyShape</span>      <span class="o">=</span> <span class="n">moon</span><span class="p">,</span>
                                <span class="n">limbDarkening</span>  <span class="o">=</span> <span class="s1">&#39;Eddington&#39;</span><span class="p">,</span>
                            <span class="n">precomputation</span> <span class="o">=</span> <span class="n">prec</span><span class="p">,</span>
                                <span class="p">)</span>

<span class="c1"># Define the solar pressure object (LUT mode)</span>
<span class="n">srp</span> <span class="o">=</span> <span class="n">SolarPressure</span><span class="p">(</span> <span class="n">lro</span><span class="p">,</span>
                                 <span class="n">rayTracer</span>      <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># None because everything has been computed in advance</span>
                                 <span class="n">baseflux</span>       <span class="o">=</span> <span class="mf">1361.8</span><span class="p">,</span>
                                 <span class="n">shadowObj</span>      <span class="o">=</span> <span class="n">shadow</span><span class="p">,</span>
                                     <span class="n">precomputation</span> <span class="o">=</span> <span class="n">prec</span><span class="p">,</span>
                                     <span class="n">lookup</span>         <span class="o">=</span> <span class="n">lut</span><span class="p">,</span> <span class="c1"># HERE WE USE THE LUT</span>
                                 <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s compute the SRP and time it</span>
<span class="n">tic</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
<span class="n">accel</span> <span class="o">=</span> <span class="n">srp</span><span class="o">.</span><span class="n">lookupCompute</span><span class="p">(</span><span class="n">epochs</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e3</span>
<span class="n">toc</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Elapsed time&#39;</span><span class="p">,</span> <span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">,</span> <span class="s1">&#39;sec&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Elapsed time 5.331204172922298 sec
</pre></div></div>
</div>
<p>This is a huge improvement with respect to the non-LUT case (live computation) that we discussed in the first example.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Notebook2.html" class="btn btn-neutral float-left" title="Solar Radiation Pressure: Various contributions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../api/index.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Gael Cascioli.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>